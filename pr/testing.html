<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Testing - Crate CI</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Simplifying Crate Management">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <base href="../">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

    </head>
    <body class="light">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme;
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            document.querySelector('html').classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li class="affix"><a href="index.html">Introduction</a></li><li><a href="pr.html"><strong aria-hidden="true">1.</strong> Managing PRs</a></li><li><ol class="section"><li><a href="pr/testing.html" class="active"><strong aria-hidden="true">1.1.</strong> Testing</a></li><li><a href="pr/rustfmt.html"><strong aria-hidden="true">1.2.</strong> Style Enforcement</a></li><li><a href="pr/clippy.html"><strong aria-hidden="true">1.3.</strong> Code Smells</a></li><li><a href="pr/coverage.html"><strong aria-hidden="true">1.4.</strong> Code Coverage</a></li></ol></li><li><a href="release.html"><strong aria-hidden="true">2.</strong> Managing Releases</a></li><li><ol class="section"><li><a href="release/changelog.html"><strong aria-hidden="true">2.1.</strong> CHANGELOG</a></li><li><a href="release/publish.html"><strong aria-hidden="true">2.2.</strong> Publishing Crates</a></li><li><a href="release/binaries.html"><strong aria-hidden="true">2.3.</strong> Prebuilt Binaries</a></li><li><a href="release/docs.html"><strong aria-hidden="true">2.4.</strong> API Documentation</a></li></ol></li><li><a href="dependencies.html"><strong aria-hidden="true">3.</strong> Wrangling Dependencies</a></li><li><ol class="section"><li><a href="dependencies/updates.html"><strong aria-hidden="true">3.1.</strong> Keeping Up on Dependencies</a></li></ol></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="submenu">
                                <li><button class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li><button class="theme" id="rust">Rust</button></li>
                                <li><button class="theme" id="coal">Coal</button></li>
                                <li><button class="theme" id="navy">Navy</button></li>
                                <li><button class="theme" id="ayu">Ayu</button></li>
                            </ul>
                        </div>

                        <h1 class="menu-title">Crate CI</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="pr/testing.html#testing" id="testing"><h1>Testing</h1></a>
<p>Pre-requisites:</p>
<ul>
<li>Crate exists</li>
<li><code>cargo test</code> runs relevant tests</li>
</ul>
<a class="header" href="pr/testing.html#questions-to-consider" id="questions-to-consider"><h2>Questions to Consider</h2></a>
<a class="header" href="pr/testing.html#platforms-to-support" id="platforms-to-support"><h3>Platforms to Support?</h3></a>
<p>Target platforms are a combination of:</p>
<ul>
<li>OS</li>
<li>CPU</li>
<li>32-bit or 64-bit</li>
<li>(Linux) libc version</li>
<li>(Windows) MSys or MSVC</li>
</ul>
<p>These platforms fall into several major categories</p>
<ul>
<li>Desktop</li>
<li>&quot;Embedded&quot;: Phones, Raspberry Pis, etc</li>
<li>Embedded: Those running <code>no_std</code></li>
</ul>
<p>If you are creating a library, the ideal situation is to support as many of these as possible.</p>
<p>If you are creating a program, it is mostly a matter of having at least one
form of binary on the systems you care about.  It would be nice to support more
in case a contributor's development environment is different than yours.</p>
<a class="header" href="pr/testing.html#rust-versions-to-support" id="rust-versions-to-support"><h3>Rust versions to Support?</h3></a>
<p>Some clients might not be able to always use the latest release.  Maintainers have taken different approaches to this</p>
<ul>
<li>Don't support older versions</li>
<li>Support <code>N</code> releases back</li>
<li>Only require compiler upgrades on major or minor</li>
</ul>
<p>In addition to numbered, releases, Rust has the following release labels</p>
<ul>
<li><code>stable</code>: The current release</li>
<li><code>beta</code>: The next release</li>
<li><code>nightly</code>: Bleeding edge with feature flags to enable &quot;unstable&quot; features
<ul>
<li>&quot;unstable&quot; from the perspective of API/behavior compatibility; this does not speak to whether it is runtime stable</li>
</ul>
</li>
</ul>
<p>Recommendation:</p>
<ul>
<li>Support 2 releases back</li>
<li>Features requiring <code>nightly</code> are hidden behind a feature flag</li>
</ul>
<a class="header" href="pr/testing.html#platform--rust-coverage" id="platform--rust-coverage"><h3>Platform / Rust Coverage?</h3></a>
<p>You can run your tests on every version of Rust and across every platform at
the cost of slower feedback on your PRs and increasing load on your chosen CI
service.</p>
<p>Recommendation:</p>
<ul>
<li>Test all platforms on &quot;2 releases back&quot; and <code>stable</code></li>
<li>Test the minimum platforms on <code>beta</code> and <code>nightly</code></li>
</ul>
<a class="header" href="pr/testing.html#ci-triggers" id="ci-triggers"><h3>CI Triggers</h3></a>
<p>Travis and related CIs by default trigger builds on</p>
<ul>
<li>Commits to branches in the repo</li>
<li>PRs</li>
<li>Tags</li>
</ul>
<p>Additionally, you can schedule builds to happen periodically.  This can be
useful to catch problems from new versions of Rust or your dependencies (if you
don't commit your <a href="https://doc.rust-lang.org/cargo/guide/cargo-toml-vs-cargo-lock.html">lock file</a>). It can be discouraging to a
contributor if the build fails on their PR for reasons unrelated to their
change.</p>
<p>In contrast, we want to be respectful of the CI services we are getting for
free and don't want to put unnecessary load on them.</p>
<p>So as a healthy medium, we recommend:</p>
<ul>
<li>If you use nightly-only features: build frequently (~1 / week)</li>
<li>All else: build monthly (<code>0 0 1 * *</code> in cron syntax)</li>
</ul>
<p>Notes:</p>
<ul>
<li>If the service offers it (like Travis), you probably want it set to &quot;Do not
run if there has been a build in the last 24 hours&quot; rather than &quot;Always run&quot;.</li>
<li>Appveyor has put <a href="https://www.appveyor.com/blog/2017/11/08/sheduled-builds-for-free-accounts/">extra restrictions on scheuled builds</a>.</li>
</ul>
<a class="header" href="pr/testing.html#running-tests-on-prs" id="running-tests-on-prs"><h2>Running Tests on PRs</h2></a>
<p>There are several CI hosts that will help you run tests on your CI</p>
<p>See also <a href="https://github.com/crate-ci/example-base">example-base</a>.</p>
<a class="header" href="pr/testing.html#travisci" id="travisci"><h3>TravisCI</h3></a>
<p>Supports:</p>
<ul>
<li>Linux</li>
<li>Mac</li>
<li><a href="https://blog.travis-ci.com/2018-10-11-windows-early-release">Windows</a></li>
</ul>
<p>Steps:</p>
<ol>
<li><a href="https://travis-ci.org/">Sign up for TravisCI</a></li>
<li>View your repositories by clicking on your name</li>
<li>Follow the steps for &quot;Review and add&quot; your organization, if needed</li>
<li>&quot;Sync account&quot; if your repo isn't showing up</li>
<li>Toggle the switch for your repo</li>
<li>Add a <code>.travis.yml</code> to your repo</li>
</ol>
<p>This is a good starting <code>.travis.yml</code>:</p>
<pre><code class="language-yml">sudo: false
language: rust
rust:
- 1.22.0  # Oldest supported
- stable
- beta
- nightly

os:
- linux
- osx
- windows

install:
- if [[ &quot;$TRAVIS_OS_NAME&quot; == &quot;windows&quot; ]]; then choco install windows-sdk-10.0; fi # windows workaround (for now)

script:
- cargo check --verbose
- cargo test --verbose

cache:
  cargo: true
</code></pre>
<p>Highlights</p>
<ul>
<li><code>sudo: false</code>: Allows Travis to do some optimizations</li>
<li><code>os</code>: Applies all tests to listed operating systems</li>
<li><code>install</code>: Windows workaround to allow rust to run properly.  Remove if you
are not testing on Windows.  Hopefully temporary as Travis CI <em>just</em> started
Windows support as of 2018-10-11.</li>
<li><code>cargo check</code>: Only needed if your project has a <code>[[bin]]</code>.  Ensure that that
builds type. <code>check</code> delivers faster turnaround than doing <code>cargo build</code>
since we don't care about the build artifact.</li>
<li><code>cargo test</code>: If your crate has <a href="https://doc.rust-lang.org/cargo/reference/manifest.html#the-features-section">features</a>, considering at
least re-running the tests with <code>--no-default-features</code> and <code>--all-features</code>,
as appropriate.</li>
<li><code>cache:</code>: <a href="https://docs.travis-ci.com/user/caching/#Rust-Cargo-cache">Cache the cargo registry and build</a></li>
</ul>
<a class="header" href="pr/testing.html#appveyor" id="appveyor"><h3>Appveyor</h3></a>
<p>Supports:</p>
<ul>
<li>Windows</li>
</ul>
<p>This is a good starting <code>appveyor.yml</code>:</p>
<pre><code class="language-yml">environment:
  global:
    CHANNEL: stable
    #APPVEYOR_CACHE_SKIP_RESTORE: true  # Uncomment when caching causes problems

  matrix:
  # Oldest supported
  - TARGET: x86_64-pc-windows-msvc
    CHANNEL: 1.22.0
  - TARGET: x86_64-pc-windows-gnu
    CHANNEL: 1.22.0
  # Stable channel
  - TARGET: i686-pc-windows-msvc
    CHANNEL: stable
  - TARGET: i686-pc-windows-gnu
    CHANNEL: stable
  - TARGET: x86_64-pc-windows-msvc
    CHANNEL: stable
  - TARGET: x86_64-pc-windows-gnu
    CHANNEL: stable
  # Beta channel
  - TARGET: x86_64-pc-windows-msvc
    CHANNEL: beta
  - TARGET: x86_64-pc-windows-gnu
    CHANNEL: beta
  # Nightly channel
  - TARGET: x86_64-pc-windows-msvc
    CHANNEL: nightly
  - TARGET: x86_64-pc-windows-gnu
    CHANNEL: nightly

install:
- ps: &gt;-
    $Env:PATH += ';C:\msys64\usr\bin'
- curl -sSf -o rustup-init.exe https://win.rustup.rs/
- rustup-init.exe -y --default-host %TARGET% --default-toolchain %CHANNEL%
- set PATH=%PATH%;C:\Users\appveyor\.cargo\bin
- rustc -Vv
- cargo -V

test_script:
- cargo check --verbose
- cargo test --verbose

cache:
- C:\Users\appveyor\.cargo\registry
- target

notifications:
- provider: Email
  on_build_success: false

# Building is done in the test phase, so we disable Appveyor's build phase.
build: false
</code></pre>
<p>Highlights:</p>
<ul>
<li><code>install</code>
<ul>
<li>Install rust using Curl (distributed with msys64)</li>
<li>Print tool versions for traceability</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="pr.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="pr/rustfmt.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="pr.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="pr/rustfmt.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if (getComputedStyle(document.querySelector(".fa")).fontFamily !== "FontAwesome") {
                var link = document.createElement('link');
                link.rel = 'stylesheet';
                link.type = 'text/css';
                link.href = '_FontAwesome/css/font-awesome.css';
                document.head.insertBefore(link, document.head.firstChild)
            }
        </script>

        

        

        
        <script src="ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>
        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS script -->
        

    </body>
</html>
